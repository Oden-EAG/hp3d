
# DEFAULT FLAG FOR OPTIMIZED OR DEBUG VERSION
ifndef OPT
OPT = 1
endif

# C++ COMPILER
CXX = g++

# COMPILER FLAGS
FLAGS = -DIPRINT=0 -Wno-deprecated
OPT_FLAGS = -O3
DBG_FLAGS = -g
ifeq ($(OPT),1)
  FLAGS += $(OPT_FLAGS)
  EXEC = vis
else
  FLAGS += $(DBG_FLAGS)
  EXEC = vis_debug
endif

LIB_DIR = /usr/lib

LIB = $(LIB_DIR)/libvtkCommon.so \
      $(LIB_DIR)/libvtkDICOMParser.so \
      $(LIB_DIR)/libvtkexoIIc.so \
      $(LIB_DIR)/libvtkFiltering.so \
      $(LIB_DIR)/libvtkftgl.so \
      $(LIB_DIR)/libvtkGenericFiltering.so \
      $(LIB_DIR)/libvtkGraphics.so \
      $(LIB_DIR)/libvtkHybrid.so \
      $(LIB_DIR)/libvtkImaging.so \
      $(LIB_DIR)/libvtkIO.so \
      $(LIB_DIR)/libvtkNetCDF.so \
      $(LIB_DIR)/libvtkRendering.so \
      $(LIB_DIR)/libvtksys.so \
      $(LIB_DIR)/libvtkVolumeRendering.so \
      $(LIB_DIR)/libvtkWidgets.so

# INCLUDE PATHS
INC_DIR = /usr/include/vtk-5.0
INC = -I$(INC_DIR)

# OBJECT FILE DIRECTORY
ifeq ($(OPT),1)
  OBJ_PATH = _RELEASE
else
  OBJ_PATH = _DEBUG
endif

# LIST OF OBJECT FILES
OBJ = $(OBJ_PATH)/main.o \
      $(OBJ_PATH)/util.o \
      $(OBJ_PATH)/geometry.o \
      $(OBJ_PATH)/geometry_hexa.o \
      $(OBJ_PATH)/geometry_tetra.o \
      $(OBJ_PATH)/geometry_prism.o \
      $(OBJ_PATH)/geometry_pyramid.o

# LINK (DEFAUlT TARGET)
$(EXEC): $(OBJ_PATH)/.dummy $(OBJ)
	$(CXX) $(FLAGS) -o $(EXEC) $(OBJ) $(LIB)

# OBJECT FILE DEPENDENCIES

$(OBJ_PATH)/main.o: main.cxx \
                    geometry.h \
                    solution.h
	$(CXX) $(FLAGS) $(INC) -o $@ -c $<

$(OBJ_PATH)/util.o: util.cxx \
                    util.h
	$(CXX) $(FLAGS) $(INC) -o $@ -c $<

$(OBJ_PATH)/geometry.o: geometry.cxx \
                        geometry.h \
                        util.h
	$(CXX) $(FLAGS) $(INC) -o $@ -c $<

$(OBJ_PATH)/geometry_hexa.o: geometry_hexa.cxx \
                             geometry.h \
                             util.h
	$(CXX) $(FLAGS) $(INC) -o $@ -c $<

$(OBJ_PATH)/geometry_tetra.o: geometry_tetra.cxx \
                              geometry.h \
                              util.h
	$(CXX) $(FLAGS) $(INC) -o $@ -c $<

$(OBJ_PATH)/geometry_prism.o: geometry_prism.cxx \
                              geometry.h \
                              util.h
	$(CXX) $(FLAGS) $(INC) -o $@ -c $<

$(OBJ_PATH)/geometry_pyramid.o: geometry_pyramid.cxx \
                                geometry.h \
                                util.h
	$(CXX) $(FLAGS) $(INC) -o $@ -c $<

$(OBJ_PATH)/solution.o: solution.cxx \
                        solution.h \
                        geometry.h \
                        util.h
	$(CXX) $(FLAGS) $(INC) -o $@ -c $<

# CREATE OBJECT FILE DIRECTORY
$(OBJ_PATH)/.dummy:
	@if [ -d  $(OBJ_PATH) ] ; then \
		touch $@; \
	else \
		mkdir $(OBJ_PATH); touch $@ ; \
	fi
